<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WorldOS // Console</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    
    <script src="https://unpkg.com/feather-icons"></script>

    <style>
        /* --- DESIGN SYSTEM: "Zinc" Palette --- */
        :root {
            --bg-app: #09090b;
            --bg-sidebar: #000000;
            --bg-card: #121214;
            --bg-input: #18181b;
            --border: #27272a;
            --border-highlight: #3f3f46;
            
            --text-main: #f4f4f5;
            --text-muted: #a1a1aa;
            
            --primary: #fff;
            --primary-inv: #000;
            --accent: #22c55e; /* Success Green */
            --danger: #ef4444;
            
            --font-ui: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            --font-mono: 'JetBrains Mono', monospace;
        }

        /* --- RESET --- */
        * { box-sizing: border-box; outline: none; }
        body { margin: 0; padding: 0; background: var(--bg-app); color: var(--text-main); font-family: var(--font-ui); height: 100vh; overflow: hidden; display: flex; }
        
        /* --- TYPOGRAPHY --- */
        h1, h2, h3 { font-weight: 500; letter-spacing: -0.02em; margin: 0; }
        .mono { font-family: var(--font-mono); font-size: 0.85em; }
        .text-sm { font-size: 0.875rem; }
        .text-xs { font-size: 0.75rem; }
        .text-muted { color: var(--text-muted); }

        /* --- LAYOUT: SIDEBAR --- */
        aside {
            width: 260px;
            background: var(--bg-sidebar);
            border-right: 1px solid var(--border);
            display: flex;
            flex-direction: column;
            padding: 1.5rem;
            z-index: 10;
        }

        .brand {
            font-family: var(--font-mono);
            font-weight: 600;
            font-size: 1rem;
            margin-bottom: 2rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .brand span { color: var(--text-muted); }

        nav button {
            background: transparent;
            border: none;
            color: var(--text-muted);
            width: 100%;
            padding: 10px 12px;
            text-align: left;
            border-radius: 6px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 0.9rem;
            font-weight: 500;
            margin-bottom: 4px;
            transition: 0.15s;
        }

        nav button:hover { background: var(--bg-card); color: var(--text-main); }
        nav button.active { background: var(--bg-input); color: var(--text-main); border: 1px solid var(--border); }
        
        .nav-footer { margin-top: auto; border-top: 1px solid var(--border); padding-top: 1rem; }

        /* --- LAYOUT: MAIN --- */
        main {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            position: relative;
        }

        header {
            height: 60px;
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 2rem;
            background: rgba(9, 9, 11, 0.8);
            backdrop-filter: blur(8px);
        }

        .breadcrumbs { color: var(--text-muted); font-size: 0.875rem; }
        .breadcrumbs span { color: var(--text-main); font-weight: 500; }

        .status-indicator {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.75rem;
            background: var(--bg-input);
            padding: 4px 10px;
            border-radius: 20px;
            border: 1px solid var(--border);
        }
        .dot { width: 6px; height: 6px; border-radius: 50%; background: var(--accent); }

        /* --- CONTENT VIEWS --- */
        .view {
            padding: 2rem;
            overflow-y: auto;
            height: 100%;
            display: none; /* Hidden by default */
        }
        .view.active { display: block; animation: fadeIn 0.3s ease; }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }

        /* --- DASHBOARD GRID --- */
        .grid-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            padding: 1.5rem;
            border-radius: 8px;
        }

        .stat-label { color: var(--text-muted); font-size: 0.8rem; text-transform: uppercase; letter-spacing: 0.05em; margin-bottom: 0.5rem; }
        .stat-value { font-size: 2rem; font-weight: 500; letter-spacing: -1px; }

        /* --- TABLES --- */
        .table-container {
            border: 1px solid var(--border);
            border-radius: 8px;
            overflow: hidden;
        }
        table { width: 100%; border-collapse: collapse; font-size: 0.9rem; }
        th { background: var(--bg-input); text-align: left; padding: 12px 16px; color: var(--text-muted); font-weight: 500; font-size: 0.8rem; border-bottom: 1px solid var(--border); }
        td { padding: 16px; border-bottom: 1px solid var(--border); color: var(--text-main); }
        tr:last-child td { border-bottom: none; }
        .hash-mono { font-family: var(--font-mono); color: var(--text-muted); font-size: 0.8rem; }

        /* --- INTELLIGENCE (CHAT) --- */
        .chat-layout {
            display: flex;
            flex-direction: column;
            height: 100%;
            max-width: 900px;
            margin: 0 auto;
        }

        .chat-window {
            flex: 1;
            overflow-y: auto;
            border: 1px solid var(--border);
            border-radius: 8px;
            background: var(--bg-card);
            padding: 1.5rem;
            margin-bottom: 1rem;
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }

        .message { display: flex; flex-direction: column; gap: 0.5rem; max-width: 90%; }
        .message.user { align-self: flex-end; align-items: flex-end; }
        .message.ai { align-self: flex-start; align-items: flex-start; }
        
        .bubble {
            padding: 12px 16px;
            border-radius: 8px;
            font-size: 0.95rem;
            line-height: 1.6;
        }
        .user .bubble { background: var(--text-main); color: var(--primary-inv); }
        .ai .bubble { background: var(--bg-input); border: 1px solid var(--border); color: var(--text-main); }
        
        .input-area {
            display: flex;
            gap: 1rem;
            background: var(--bg-input);
            padding: 10px;
            border: 1px solid var(--border);
            border-radius: 8px;
        }

        textarea {
            flex: 1;
            background: transparent;
            border: none;
            color: white;
            resize: none;
            font-family: var(--font-ui);
            font-size: 0.95rem;
            padding: 8px;
            height: 40px;
        }

        .btn-send {
            background: var(--text-main);
            color: black;
            border: none;
            border-radius: 6px;
            padding: 0 20px;
            font-weight: 600;
            cursor: pointer;
            transition: 0.2s;
        }
        .btn-send:hover { opacity: 0.9; }
        .btn-send:disabled { opacity: 0.5; cursor: not-allowed; }

        /* --- MODAL (API KEY) --- */
        .api-warning {
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid rgba(239, 68, 68, 0.2);
            color: #fca5a5;
            padding: 1rem;
            border-radius: 6px;
            margin-bottom: 1rem;
            font-size: 0.9rem;
        }

        input[type="password"] {
            width: 100%;
            background: var(--bg-app);
            border: 1px solid var(--border);
            padding: 12px;
            color: white;
            border-radius: 6px;
            font-family: var(--font-mono);
            margin-bottom: 1rem;
        }

    </style>
</head>
<body>

    <aside>
        <div class="brand">
            <i data-feather="hexagon"></i>
            WORLD<span>OS</span>
        </div>
        
        <nav>
            <button class="nav-btn active" onclick="nav('dashboard')">
                <i data-feather="grid"></i> Dashboard
            </button>
            <button class="nav-btn" onclick="nav('intelligence')">
                <i data-feather="cpu"></i> Intelligence
            </button>
            <button class="nav-btn" onclick="nav('vault')">
                <i data-feather="database"></i> Data Vault
            </button>
        </nav>

        <div class="nav-footer">
            <button class="nav-btn" onclick="nav('settings')">
                <i data-feather="settings"></i> Settings
            </button>
        </div>
    </aside>

    <main>
        <header>
            <div class="breadcrumbs" id="breadcrumbs">WorldOS / <span>Dashboard</span></div>
            <div class="status-indicator">
                <div class="dot"></div>
                <span class="mono">CONNECTED</span>
            </div>
        </header>

        <div id="view-dashboard" class="view active">
            <h2 style="margin-bottom: 1.5rem;">System Overview</h2>
            
            <div class="grid-stats">
                <div class="stat-card">
                    <div class="stat-label">Total Deposits</div>
                    <div class="stat-value" id="stat-deposits">12</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Storage Used</div>
                    <div class="stat-value">42.8 <span class="text-muted text-sm">MB</span></div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Network Status</div>
                    <div class="stat-value" style="color:var(--accent)">100%</div>
                </div>
            </div>

            <h3 style="margin-bottom: 1rem;">Recent Proofs</h3>
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>FILE NAME</th>
                            <th>HASH</th>
                            <th>TIMESTAMP</th>
                        </tr>
                    </thead>
                    <tbody id="dash-table-body">
                        </tbody>
                </table>
            </div>
        </div>

        <div id="view-intelligence" class="view">
            <div class="chat-layout">
                <div style="margin-bottom: 1rem; display:flex; justify-content:space-between; align-items:center;">
                    <h2>Neural Interface</h2>
                    <span class="mono text-muted text-xs">MODEL: GEMINI-1.5-FLASH</span>
                </div>
                
                <div id="gemini-chat-window" class="chat-window">
                    <div class="message ai">
                        <div class="bubble">
                            System initialized. I am WorldOS Intelligence. Please verify your API Key in Settings before proceeding, then provide data for analysis.
                        </div>
                    </div>
                </div>

                <div class="input-area">
                    <textarea id="ai-input" placeholder="Query the system... (e.g., 'Analyze the hash patterns', 'Draft a security protocol')"></textarea>
                    <button id="ai-send" class="btn-send"><i data-feather="arrow-up"></i></button>
                </div>
            </div>
        </div>

        <div id="view-vault" class="view">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:2rem;">
                <h2>Data Vault</h2>
                <button class="btn-send" style="height:40px;" onclick="document.getElementById('file-upload').click()">+ Deposit File</button>
                <input type="file" id="file-upload" style="display:none">
            </div>

            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>FILE NAME</th>
                            <th>SIZE</th>
                            <th>ENCRYPTION</th>
                            <th>PROOF</th>
                        </tr>
                    </thead>
                    <tbody id="vault-table-body">
                        <tr>
                            <td colspan="4" style="text-align:center; padding:3rem; color:var(--text-muted)">
                                Vault initialized. Upload files to generate hashes.
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <div id="view-settings" class="view">
            <div style="max-width: 500px;">
                <h2 style="margin-bottom: 2rem;">Configuration</h2>
                
                <div class="stat-card">
                    <h3 style="margin-bottom: 1rem;">Gemini API Integration</h3>
                    <p class="text-muted text-sm" style="margin-bottom: 1rem;">
                        WorldOS requires a Google Gemini API key to perform neural analysis. The key is stored in your browser's session memory only.
                    </p>
                    
                    <div class="api-warning">
                        <i data-feather="alert-triangle" style="width:14px; vertical-align:middle"></i>
                        Security Note: Never share this key.
                    </div>

                    <label class="stat-label">API Key</label>
                    <input type="password" id="api-key-input" placeholder="Paste key here (AIzaSy...)">
                    <button id="save-key-btn" class="btn-send" style="width:100%; padding: 12px 0;">Save Configuration</button>
                    <p id="key-status" class="mono text-xs" style="margin-top:10px; color:var(--accent); display:none;">KEY SAVED SECURELY</p>
                </div>
            </div>
        </div>

    </main>

    <script>
        // --- ICONS ---
        feather.replace();

        // --- STATE MANAGEMENT ---
        const state = {
            view: 'dashboard',
            apiKey: '',
            vault: [
                { id: '001', name: 'world_os_manifest.json', hash: 'e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855', ts: '2025-11-25 09:30' },
                { id: '002', name: 'supply_chain_v4.pdf', hash: '87428fc522803d31065e7bce3cf03fe475096631e5e07bbd7a0fde60c4cf25c7', ts: '2025-11-25 10:15' }
            ]
        };

        // --- NAVIGATION ---
        function nav(viewName) {
            // Update Menu
            document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.remove('active'));
            // Find button roughly by text content or logic (simplified for demo)
            // Ideally we'd add IDs to buttons, but let's just use the onclick trigger visual update
            event.currentTarget.classList.add('active');

            // Update View
            document.querySelectorAll('.view').forEach(el => el.classList.remove('active'));
            document.getElementById(`view-${viewName}`).classList.add('active');

            // Update Breadcrumbs
            const niceName = viewName.charAt(0).toUpperCase() + viewName.slice(1);
            document.getElementById('breadcrumbs').innerHTML = `WorldOS / <span>${niceName}</span>`;
            
            state.view = viewName;
        }

        // --- SETTINGS: API KEY ---
        document.getElementById('save-key-btn').addEventListener('click', () => {
            const input = document.getElementById('api-key-input').value;
            if(input.length > 10) {
                state.apiKey = input;
                const status = document.getElementById('key-status');
                status.style.display = 'block';
                status.textContent = "KEY STORED IN SESSION MEMORY";
                setTimeout(() => { status.style.display = 'none'; }, 3000);
            } else {
                alert("Invalid Key format");
            }
        });

        // --- INTELLIGENCE: GEMINI API CALL ---
        const chatWindow = document.getElementById('gemini-chat-window');
        const aiInput = document.getElementById('ai-input');
        const aiSend = document.getElementById('ai-send');

        function appendMessage(role, text) {
            const div = document.createElement('div');
            div.className = `message ${role}`;
            
            // Basic markdown parsing for code blocks and bold
            let formatted = text
                .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                .replace(/```([\s\S]*?)```/g, '<pre style="background:#000; padding:10px; border-radius:4px; overflow-x:auto;"><code>$1</code></pre>');

            div.innerHTML = `<div class="bubble">${formatted}</div>`;
            chatWindow.appendChild(div);
            chatWindow.scrollTop = chatWindow.scrollHeight;
        }

        async function callGemini(prompt) {
            if(!state.apiKey) {
                appendMessage('ai', '‚ùå **Error:** API Key missing. Please go to Settings and configure your Google Gemini Key.');
                return;
            }

            // UI Loading state
            aiInput.value = '';
            aiInput.disabled = true;
            aiSend.disabled = true;
            appendMessage('user', prompt);
            
            const loadingId = 'loading-' + Date.now();
            const loaderDiv = document.createElement('div');
            loaderDiv.className = 'message ai';
            loaderDiv.id = loadingId;
            loaderDiv.innerHTML = `<div class="bubble text-muted mono">Processing request via Neural Node...</div>`;
            chatWindow.appendChild(loaderDiv);

            try {
                const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${state.apiKey}`;
                
                const response = await fetch(url, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{
                            parts: [{ text: prompt }]
                        }],
                        system_instruction: {
                            parts: [{ text: "You are WorldOS Intelligence, a high-level strategic data analyst. You speak in a professional, concise, slightly futuristic tone. Use markdown for formatting. You are integrated into a sovereign data bank." }]
                        }
                    })
                });

                const data = await response.json();
                
                // Remove loader
                document.getElementById(loadingId).remove();

                if (data.error) {
                    appendMessage('ai', `**System Error:** ${data.error.message}`);
                } else {
                    const aiText = data.candidates[0].content.parts[0].text;
                    appendMessage('ai', aiText);
                }

            } catch (err) {
                document.getElementById(loadingId).remove();
                appendMessage('ai', `**Connection Failure:** ${err.message}`);
            }

            aiInput.disabled = false;
            aiSend.disabled = false;
            aiInput.focus();
        }

        aiSend.addEventListener('click', () => {
            const txt = aiInput.value.trim();
            if(txt) callGemini(txt);
        });

        aiInput.addEventListener('keypress', (e) => {
            if(e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                aiSend.click();
            }
        });

        // --- MOCK DATA RENDER ---
        function renderDashboard() {
            const tbody = document.getElementById('dash-table-body');
            tbody.innerHTML = '';
            state.vault.forEach(file => {
                tbody.innerHTML += `
                    <tr>
                        <td class="mono text-muted">#${file.id}</td>
                        <td style="font-weight:500">${file.name}</td>
                        <td class="hash-mono">${file.hash.substring(0,20)}...</td>
                        <td class="text-sm text-muted">${file.ts}</td>
                    </tr>
                `;
            });
            document.getElementById('stat-deposits').textContent = state.vault.length;
        }

        // File Upload Simulation
        document.getElementById('file-upload').addEventListener('change', (e) => {
            if(e.target.files[0]) {
                const file = e.target.files[0];
                const newEntry = {
                    id: '00' + (state.vault.length + 1),
                    name: file.name,
                    hash: Array.from({length: 64}, () => Math.floor(Math.random()*16).toString(16)).join(''),
                    ts: new Date().toISOString().slice(0,16).replace('T', ' ')
                };
                state.vault.unshift(newEntry);
                alert(`File Encrypted & Hashed:\n${newEntry.hash.substring(0,30)}...`);
                renderDashboard();
                
                // Switch to dashboard to see it
                nav('dashboard');
                // Re-find the button visually
                document.querySelectorAll('.nav-btn')[0].classList.add('active');
                document.querySelectorAll('.nav-btn')[2].classList.remove('active');
            }
        });

        // Init
        renderDashboard();

    </script>
</body>
</html>
