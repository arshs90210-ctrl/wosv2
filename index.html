<!DOCTYPE html>
<html lang="en">
<head>
Â  Â  <meta charset="UTF-8">
Â  Â  <meta name="viewport" content="width=device-width, initial-scale=1.0">
Â  Â  <title>WorldOS: Sovereign Data Funds Platform</title>
Â  Â Â 
Â  Â  <link rel="preconnect" href="https://fonts.googleapis.com">
Â  Â  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=JetBrains+Mono:wght@400;500;700&display=swap" rel="stylesheet">
Â  Â Â 
Â  Â  <script src="https://unpkg.com/feather-icons"></script>
Â  Â  <script src="https://cdn.tailwindcss.com"></script>
Â  Â  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
Â  Â Â 
Â  Â  <style>
Â  Â  Â  Â  /* New Deep Navy/Teal/White Palette for Financial/AI Aesthetic */
Â  Â  Â  Â  :root {
Â  Â  Â  Â  Â  Â  --accent: #0e7490; /* Tailwind cyan-700 (Deep Teal) */
Â  Â  Â  Â  Â  Â  --accent-inv: #f0f9ff; /* Tailwind sky-50 (White/Off-white) */
Â  Â  Â  Â  Â  Â  --primary: #e2e8f0; /* Tailwind slate-200 (Clean Data Text) */
Â  Â  Â  Â  Â  Â  --secondary: #94a3b8; /* Tailwind slate-400 (Metadata/Labels) */
Â  Â  Â  Â  Â  Â  --indicator-ok: #10b981; /* Tailwind emerald-500 (Positive/Green) */
Â  Â  Â  Â  Â  Â  --indicator-warn: #f59e0b; /* Tailwind amber-500 (Yield/Warning/Yellow) */
Â  Â  Â  Â  Â  Â  --border: #334155; /* Tailwind slate-700 (Clean Separators) */
Â  Â  Â  Â  Â  Â  --panel: #1e293b; /* Tailwind slate-800 (Sidebar/Card Background) */
Â  Â  Â  Â  Â  Â  --surface: #0f172a; /* Tailwind slate-900 (Main Background) */
Â  Â  Â  Â  Â  Â  --text-sec: var(--secondary);
Â  Â  Â  Â  }

Â  Â  Â  Â  /* Applying new CSS Variables */
Â  Â  Â  Â  .bg-os { background-color: var(--surface); }
Â  Â  Â  Â  .bg-panel { background-color: var(--panel); }
Â  Â  Â  Â  .bg-surface-light { background-color: var(--panel); } /* Used for lifted cards */
Â  Â  Â  Â  .bg-surface-dark { background-color: var(--surface); } /* Used for main background */
Â  Â  Â  Â  .border-theme { border-color: var(--border); }
Â  Â  Â  Â  .text-primary { color: var(--primary); }
Â  Â  Â  Â  .text-secondary { color: var(--secondary); }
Â  Â  Â  Â  .text-accent { color: var(--accent); }
Â  Â  Â  Â  .text-accent-inv { color: var(--accent-inv); }
Â  Â  Â  Â  .text-indicator-ok { color: var(--indicator-ok); }
Â  Â  Â  Â  .text-indicator-warn { color: var(--indicator-warn); }

Â  Â  Â  Â  .nav-item {Â 
Â  Â  Â  Â  Â  Â  color: var(--secondary);Â 
Â  Â  Â  Â  Â  Â  transition: color 0.2s, background-color 0.2s;Â 
Â  Â  Â  Â  Â  Â  border-left: 2px solid transparent; /* Bloomberg vertical line style */
Â  Â  Â  Â  }
Â  Â  Â  Â  .nav-item:hover { color: var(--primary); }
Â  Â  Â  Â  .nav-item.active {Â 
Â  Â  Â  Â  Â  Â  color: var(--primary);Â 
Â  Â  Â  Â  Â  Â  background-color: rgba(14, 116, 144, 0.1);Â 
Â  Â  Â  Â  Â  Â  border-left-color: var(--accent);
Â  Â  Â  Â  }
Â  Â  Â  Â  .nav-item.active i { color: var(--accent); }
Â  Â  Â  Â  .fade-in { animation: fadeIn 0.5s ease-out forwards; }
Â  Â  Â  Â  @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
Â  Â  Â  Â  .font-code { font-family: 'JetBrains Mono', monospace; }
Â  Â  Â  Â Â 
Â  Â  Â  Â  /* Adjusted Ledger Entry Style */
Â  Â  Â  Â  .ledger-entry {Â 
Â  Â  Â  Â  Â  Â  background-color: var(--surface);Â 
Â  Â  Â  Â  Â  Â  border: 1px solid var(--border);
Â  Â  Â  Â  Â  Â  transition: background-color 0.2s;
Â  Â  Â  Â  }
Â  Â  Â  Â  .ledger-entry:hover { background-color: #1a2434; } /* Subtle hover */

Â  Â  Â  Â  /* Input Styling Fix */
Â  Â  Â  Â  .auth-input, .ai-input-style {
Â  Â  Â  Â  Â  Â  Â background-color: var(--surface);Â 
Â  Â  Â  Â  Â  Â  Â border: 1px solid var(--border);Â 
Â  Â  Â  Â  Â  Â  Â color: var(--primary);
Â  Â  Â  Â  Â  Â  Â transition: border-color 0.2s;
Â  Â  Â  Â  }
Â  Â  Â  Â  .auth-input:focus, .ai-input-style:focus {
Â  Â  Â  Â  Â  Â  border-color: var(--accent);
Â  Â  Â  Â  Â  Â  outline: none;
Â  Â  Â  Â  }
Â  Â  </style>
Â  Â Â 
Â  Â  <script type="module">
Â  Â  Â  Â  // Import only necessary Firestore functions for data simulation
Â  Â  Â  Â  import { getFirestore, doc, setDoc, updateDoc, onSnapshot, collection, query, getDocs, arrayUnion, addDoc, serverTimestamp, orderBy } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
Â  Â  Â  Â  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
Â  Â  Â  Â Â 
Â  Â  Â  Â  // Expose Firebase objects globally within the module scope
Â  Â  Â  Â  const firebase = {
Â  Â  Â  Â  Â  Â  initializeApp,
Â  Â  Â  Â  Â  Â  getFirestore, doc, setDoc, updateDoc, onSnapshot, collection, query, getDocs,
Â  Â  Â  Â  Â  Â  arrayUnion, addDoc, serverTimestamp, orderBy
Â  Â  Â  Â  };
Â  Â  Â  Â Â 
Â  Â  Â  Â  // --- GLOBAL CONSTANTS ---
Â  Â  Â  Â  const DB_NAME = 'WorldOS_SovereignNode_Local';
Â  Â  Â  Â  const DB_VERSION = 1;
Â  Â  Â  Â  const COMMISSION_RATE = 0.15;
Â  Â  Â  Â Â 
Â  Â  Â  Â  // FIXED: Dummy User ID and Type for immediate access
Â  Â  Â  Â  let db;
Â  Â  Â  Â  let userId = 'DUMMY_INDIVIDUAL_USER_001';
Â  Â  Â  Â  let userType = 'individual';
Â  Â  Â  Â  let userProfile = { totalYield: 0, funds: {}, userType: 'individual' };

Â  Â  Â  Â  // Dummy Firebase Config/App ID (Needed for Firestore paths)
Â  Â  Â  Â  const __app_id = 'worldos-sovereign-node-demo';
Â  Â  Â  Â  const firebaseConfig = {
Â  Â  Â  Â  Â  Â  apiKey: "AIzaSy_dummy-api-key-for-test-ONLY",
Â  Â  Â  Â  Â  Â  authDomain: "dummy-project.firebaseapp.com",
Â  Â  Â  Â  Â  Â  projectId: "dummy-project",
Â  Â  Â  Â  Â  Â  storageBucket: "dummy-project.appspot.com",
Â  Â  Â  Â  Â  Â  messagingSenderId: "123456789012",
Â  Â  Â  Â  Â  Â  appId: "1:123456789012:web:a1b2c3d4e5f6g7h8"
Â  Â  Â  Â  };


Â  Â  Â  Â  // --- GLOBAL STATE ---
Â  Â  Â  Â  let WorldState = {
Â  Â  Â  Â  Â  Â  db: null, // IndexedDB instance
Â  Â  Â  Â  Â  Â  dataFunds: [] // Firestore funds metadata
Â  Â  Â  Â  };
Â  Â  Â  Â Â 
Â  Â  Â  Â  // --- 0. DATA PERSISTENCE (INDEXEDDB - LOCAL CONTENT) ---
Â  Â  Â  Â  const LocalDB = {
Â  Â  Â  Â  Â  Â  init: () => {
Â  Â  Â  Â  Â  Â  Â  Â  return new Promise((resolve, reject) => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const request = indexedDB.open(DB_NAME, DB_VERSION);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  request.onupgradeneeded = (e) => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  WorldState.db = e.target.result;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  WorldState.db.createObjectStore('files', { keyPath: 'id' });
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  };
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  request.onsuccess = (e) => { WorldState.db = e.target.result; resolve(); };
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  request.onerror = (e) => { console.error("IndexedDB Error:", e.target.error); reject(e.target.error); };
Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  getStore: (storeName, mode) => WorldState.db.transaction(storeName, mode).objectStore(storeName),
Â  Â  Â  Â  Â  Â  putFile: (file) => new Promise((resolve, reject) => {
Â  Â  Â  Â  Â  Â  Â  Â  const request = LocalDB.getStore('files', 'readwrite').put(file);
Â  Â  Â  Â  Â  Â  Â  Â  request.onsuccess = () => resolve(request.result);
Â  Â  Â  Â  Â  Â  Â  Â  request.onerror = () => reject(request.error);
Â  Â  Â  Â  Â  Â  }),
Â  Â  Â  Â  Â  Â  getAllFiles: () => new Promise((resolve, reject) => {
Â  Â  Â  Â  Â  Â  Â  Â  const request = LocalDB.getStore('files', 'readonly').getAll();
Â  Â  Â  Â  Â  Â  Â  Â  request.onsuccess = () => resolve(request.result);
Â  Â  Â  Â  Â  Â  Â  Â  request.onerror = () => reject(request.error);
Â  Â  Â  Â  Â  Â  })
Â  Â  Â  Â  };

Â  Â  Â  Â  // --- CORE ROUTER (EXPOSED) ---
Â  Â  Â  Â  const Router = window.Router = {
Â  Â  Â  Â  Â  Â  nav: (viewId, element) => {
Â  Â  Â  Â  Â  Â  Â  Â  document.querySelectorAll('.view-section').forEach(el => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  el.classList.add('hidden');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  el.classList.remove('fade-in');
Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  const targetView = document.getElementById('view-' + viewId);
Â  Â  Â  Â  Â  Â  Â  Â  targetView.classList.remove('hidden');
Â  Â  Â  Â  Â  Â  Â  Â  targetView.classList.add('fade-in');

Â  Â  Â  Â  Â  Â  Â  Â  document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
Â  Â  Â  Â  Â  Â  Â  Â  if (element) element.classList.add('active');
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('breadcrumb').innerText = `SYSTEM // ${viewId.toUpperCase()}`;

Â  Â  Â  Â  Â  Â  Â  Â  if (viewId === 'vault') UI.renderVault();
Â  Â  Â  Â  Â  Â  Â  Â  if (viewId === 'ledger') UI.renderLedger();
Â  Â  Â  Â  Â  Â  Â  Â  if (viewId === 'marketplace') DataFunds.render();
Â  Â  Â  Â  Â  Â  Â  Â  // FIX: AI/Intelligence View Guidance
Â  Â  Â  Â  Â  Â  Â  Â  if (viewId === 'intelligence') UI.renderIntelligenceView();
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  };

Â  Â  Â  Â  // --- FIREBASE INITIALIZATION (Simplified to only initialize Firestore) ---
Â  Â  Â  Â  const FirebaseInit = {
Â  Â  Â  Â  Â  Â  setup: async () => {
Â  Â  Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const app = firebase.initializeApp(firebaseConfig);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  db = firebase.getFirestore(app);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  FirebaseInit.loadUserProfile(userId);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  UI.enableApp();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  } catch (e) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.error("Firebase setup failed:", e);
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  loadUserProfile: (uid) => {
Â  Â  Â  Â  Â  Â  Â  Â  const userDocRef = firebase.doc(db, "artifacts", __app_id, "users", uid, "profile", "data");
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  firebase.onSnapshot(userDocRef, (docSnap) => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (docSnap.exists()) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  userProfile = docSnap.data();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  userType = userProfile.userType || 'individual';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (userProfile.userType === 'company' && userId !== 'DUMMY_COMPANY_USER_001') {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â userId = 'DUMMY_COMPANY_USER_001';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Create a default profile if it doesn't exist
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  userProfile = { totalYield: 0, funds: {}, userType: userType };
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  firebase.setDoc(userDocRef, userProfile);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  UI.updateHeader();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  DataFunds.listen();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  UI.renderLedger();
Â  Â  Â  Â  Â  Â  Â  Â  }, (error) => console.error("Error loading user profile:", error));
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  };

Â  Â  Â  Â  // --- CORE LOGIC BLOCKS ---
Â  Â  Â  Â Â 
Â  Â  Â  Â  const CryptoCore = {
Â  Â  Â  Â  Â  Â  async sha256(message) {
Â  Â  Â  Â  Â  Â  Â  Â  const msgBuffer = new TextEncoder().encode(message);
Â  Â  Â  Â  Â  Â  Â  Â  const hashBuffer = await crypto.subtle.digest('SHA-256', msgBuffer);
Â  Â  Â  Â  Â  Â  Â  Â  const hashArray = Array.from(new Uint8Array(hashBuffer));
Â  Â  Â  Â  Â  Â  Â  Â  return hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  };
Â  Â  Â  Â Â 
Â  Â  Â  Â  const Vault = window.Vault = {
Â  Â  Â  Â  Â  Â  ingest: async (input) => {
Â  Â  Â  Â  Â  Â  Â  Â  if (userType !== 'individual') return alert('Please switch to Individual Data Sovereign mode to deposit files.');
Â  Â  Â  Â  Â  Â  Â  Â  const file = input.files[0];
Â  Â  Â  Â  Â  Â  Â  Â  if (!file) return;

Â  Â  Â  Â  Â  Â  Â  Â  const text = await file.text();
Â  Â  Â  Â  Â  Â  Â  Â  const fileId = crypto.randomUUID();

Â  Â  Â  Â  Â  Â  Â  Â  const podHash = await CryptoCore.sha256(text + Date.now());Â 
Â  Â  Â  Â  Â  Â  Â  Â  // FIX: Data Categorization - allow multi-tagging (via comma-separated categories)
Â  Â  Â  Â  Â  Â  Â  Â  const categories = Vault.categorize(file.name, text);
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  const fileMetadata = {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  id: fileId,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  name: file.name,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  size: file.size,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  sizeKB: (file.size / 1024).toFixed(2),
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // FIX: Use the list of categories for fund allocation
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  marketCategory: categories.join(', '), // Store as comma-separated string for display
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // FIX: Value Differentiated PoU - Start low, PoU action must increase it
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  pouScore: 10,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  isAllocated: false,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  podHash: podHash,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ownerId: userId,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  timestamp: firebase.serverTimestamp()
Â  Â  Â  Â  Â  Â  Â  Â  };

Â  Â  Â  Â  Â  Â  Â  Â  await LocalDB.putFile({ id: fileId, content: text, categories: categories, ...fileMetadata });
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  const metadataColRef = firebase.collection(db, "artifacts", __app_id, "users", userId, "fileMetadata");
Â  Â  Â  Â  Â  Â  Â  Â  await firebase.addDoc(metadataColRef, fileMetadata);
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  const ledgerColRef = firebase.collection(db, "artifacts", __app_id, "users", userId, "userLedger");
Â  Â  Â  Â  Â  Â  Â  Â  await firebase.addDoc(ledgerColRef, {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  hash: podHash,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  action: `DEPOSIT: ${file.name} (${categories.join('/')})`,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  type: 'POD',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  timestamp: firebase.serverTimestamp()
Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  // FIX: Deposit Flow Enhancement
Â  Â  Â  Â  Â  Â  Â  Â  alert(`SECURE DEPOSIT COMPLETE: File Metadata Synced. Raw File is Local.\n\nRECOMMENDED NEXT STEP: Your financial data is deposited. Now go to the Neural Core (PoU) tab and run a query to boost its utility score.`);
Â  Â  Â  Â  Â  Â  Â  Â  input.value = '';
Â  Â  Â  Â  Â  Â  Â  Â  UI.renderVault();
Â  Â  Â  Â  Â  Â  Â  Â  UI.updateHeader();
Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  // FIX: Data Categorization - Expanded logic for multi-category tagging
Â  Â  Â  Â  Â  Â  categorize: (filename, content) => {
Â  Â  Â  Â  Â  Â  Â  Â  const lowFilename = filename.toLowerCase();
Â  Â  Â  Â  Â  Â  Â  Â  const lowContent = content.toLowerCase();
Â  Â  Â  Â  Â  Â  Â  Â  const categories = [];

Â  Â  Â  Â  Â  Â  Â  Â  if (lowFilename.includes('bank') || lowFilename.includes('tax') || lowContent.includes('chase') || lowContent.includes('amex')) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  categories.push('Financial/Tax');
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  if (lowFilename.includes('mobility') || lowFilename.includes('ev') || lowContent.includes('tesla') || lowContent.includes('uber')) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  categories.push('Urban/Mobility');
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  if (lowFilename.includes('shopping') || lowContent.includes('amazon') || lowContent.includes('target')) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  categories.push('Retail/E-commerce');
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  return categories.length > 0 ? categories : ['General/Other'];
Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  };

Â  Â  Â  Â  const DataFunds = window.DataFunds = {
Â  Â  Â  Â  Â  Â  listen: () => {
Â  Â  Â  Â  Â  Â  Â  Â  const fundsColRef = firebase.collection(db, "artifacts", __app_id, "public", "data", "dataFunds");
Â  Â  Â  Â  Â  Â  Â  Â  const q = firebase.query(fundsColRef);Â 
Â  Â  Â  Â  Â  Â  Â  Â  firebase.onSnapshot(q, (snapshot) => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  WorldState.dataFunds = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  DataFunds.render();
Â  Â  Â  Â  Â  Â  Â  Â  }, (error) => console.error("Error loading funds:", error));
Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  render: () => {
Â  Â  Â  Â  Â  Â  Â  Â  UI.renderDataFunds();
Â  Â  Â  Â  Â  Â  Â  Â  UI.renderYieldPortfolio();
Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  // FIX: Allocation Logic - simplified logic now allows allocation if ANY file category matches fund.category
Â  Â  Â  Â  Â  Â  toggleFundAllocation: async (fundId, isJoining) => {
Â  Â  Â  Â  Â  Â  Â  Â  if (userType !== 'individual') return alert('Only individual users can allocate data to funds.');
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  const files = await LocalDB.getAllFiles();
Â  Â  Â  Â  Â  Â  Â  Â  const fund = WorldState.dataFunds.find(f => f.id === fundId);
Â  Â  Â  Â  Â  Â  Â  Â  if (!fund) return alert('Fund not found.');

Â  Â  Â  Â  Â  Â  Â  Â  // Find assets that match the fund's required category
Â  Â  Â  Â  Â  Â  Â  Â  const matchingAssets = files.filter(f => f.categories.includes(fund.category));

Â  Â  Â  Â  Â  Â  Â  Â  if (matchingAssets.length === 0) return alert(`Deposit files categorized as '${fund.category}' first to join this fund.`);

Â  Â  Â  Â  Â  Â  Â  Â  // Calculate Weighted Asset Count (simplified: sum of PoU scores)
Â  Â  Â  Â  Â  Â  Â  Â  // FIX: Asset Count Metric - Uses a simplified WAC for the demo
Â  Â  Â  Â  Â  Â  Â  Â  const weightedAssetCount = matchingAssets.reduce((sum, f) => sum + (f.pouScore / 100), 0).toFixed(2);
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  const userDocRef = firebase.doc(db, "artifacts", __app_id, "users", userId, "profile", "data");
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  if (isJoining) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (userProfile.funds && userProfile.funds[fundId]) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  alert(`Already allocated to ${fundId}.`);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  await firebase.updateDoc(userDocRef, {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  [`funds.${fundId}`]: {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  allocationTime: firebase.serverTimestamp(),
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Use the calculated Weighted Asset Count
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  assetCount: parseFloat(weightedAssetCount)
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  alert(`Successfully allocated ${matchingAssets.length} assets (WAC: ${weightedAssetCount}) to ${fundId}!`);
Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  let newFunds = { ...userProfile.funds };
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  delete newFunds[fundId];
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  await firebase.setDoc(userDocRef, { funds: newFunds }, { merge: true });
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  alert(`Deallocated from ${fundId}.`);
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  UI.renderYieldPortfolio();
Â  Â  Â  Â  Â  Â  Â  Â  UI.renderVault();
Â  Â  Â  Â  Â  Â  Â  Â  UI.updateHeader();
Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  simulatePayout: async () => {
Â  Â  Â  Â  Â  Â  Â  Â  if (userType !== 'company') return alert('Please switch to Enterprise Data Buyer mode to trigger a B2B usage/payout event.');

Â  Â  Â  Â  Â  Â  Â  Â  const B2B_SDA_BUNDLE_PRICE = 50000;Â 
Â  Â  Â  Â  Â  Â  Â  Â  const commission = B2B_SDA_BUNDLE_PRICE * COMMISSION_RATE;
Â  Â  Â  Â  Â  Â  Â  Â  const payoutPool = B2B_SDA_BUNDLE_PRICE - commission;

Â  Â  Â  Â  Â  Â  Â  Â  const allUsersSnapshot = await firebase.getDocs(firebase.collection(db, "artifacts", __app_id, "users"));
Â  Â  Â  Â  Â  Â  Â  Â  let totalAssetCount = 0;
Â  Â  Â  Â  Â  Â  Â  Â  let userAssetMap = {};

Â  Â  Â  Â  Â  Â  Â  Â  // Calculate the total Weighted Asset Count across all users (as recorded in their profile)
Â  Â  Â  Â  Â  Â  Â  Â  for (const docSnap of allUsersSnapshot.docs) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const profile = docSnap.data();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (profile.userType === 'individual' && profile.funds) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  let userWAC = 0;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  for (const fundId in profile.funds) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Using the WAC calculation saved during allocation
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  userWAC += profile.funds[fundId].assetCount;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (userWAC > 0) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â userAssetMap[docSnap.id] = userWAC;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â totalAssetCount += userWAC;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  if (totalAssetCount === 0) return alert('No users currently contributing assets.');

Â  Â  Â  Â  Â  Â  Â  Â  const yieldPayouts = {};
Â  Â  Â  Â  Â  Â  Â  Â  for (const uid in userAssetMap) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const share = userAssetMap[uid] / totalAssetCount;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  yieldPayouts[uid] = payoutPool * share;
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  const updatePromises = [];
Â  Â  Â  Â  Â  Â  Â  Â  for (const uid in yieldPayouts) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const userRef = firebase.doc(db, "artifacts", __app_id, "users", uid, "profile", "data");
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  updatePromises.push(firebase.updateDoc(userRef, {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  totalYield: firebase.arrayUnion({
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  amount: yieldPayouts[uid],
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  date: firebase.serverTimestamp(),
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  source: 'SDA B2B Bundle Sale'
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  })
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }));
Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  const companyLedgerRef = firebase.collection(db, "artifacts", __app_id, "users", userId, "userLedger");
Â  Â  Â  Â  Â  Â  Â  Â  await firebase.addDoc(companyLedgerRef, {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  action: "B2B SDA Bundle Purchase",
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  details: `Paid \$${B2B_SDA_BUNDLE_PRICE.toFixed(2)} to use derivative assets. WorldOS commission: \$${commission.toFixed(2)}.`,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  timestamp: firebase.serverTimestamp(),
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  type: 'COMPANY_EXPENSE'
Â  Â  Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  Â  Â  await Promise.all(updatePromises);
Â  Â  Â  Â  Â  Â  Â  Â  alert(`SUCCESS: Simulated B2B Purchase and distributed \$${payoutPool.toFixed(2)} yield across ${Object.keys(yieldPayouts).length} users!`);
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  };

Â  Â  Â  Â  const AI = window.AI = {
Â  Â  Â  Â  Â  Â  Â send: async () => {
Â  Â  Â  Â  Â  Â  Â  Â  if (userType !== 'individual') return alert('Only individual users can generate Proof of Utility blocks.');
Â  Â  Â  Â  Â  Â  Â  Â  const input = document.getElementById('ai-input');
Â  Â  Â  Â  Â  Â  Â  Â  const query = input.value.trim().toLowerCase();
Â  Â  Â  Â  Â  Â  Â  Â  if(!query) return;

Â  Â  Â  Â  Â  Â  Â  Â  AI.appendChat('user', input.value);
Â  Â  Â  Â  Â  Â  Â  Â  input.value = '';

Â  Â  Â  Â  Â  Â  Â  Â  AI.appendChat('ai', 'Thinking...', true);
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  setTimeout(async () => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const files = await LocalDB.getAllFiles();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const hits = files.filter(f => f.categories.includes('Financial/Tax') && (f.content.toLowerCase().includes(query) || f.name.toLowerCase().includes(query)));
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  let response = "";
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const lastMsg = document.querySelector('.loading-msg');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (hits.length > 0) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // FIX: PoU Integrity - Simulate Merkle Root Hash
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const merkelRoot = await CryptoCore.sha256(query + hits.map(h => h.id).sort().join(''));
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // FIX: Value Differentiated PoU - Dynamically update PoU Score of all hit files
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const pouScoreIncrease = 20 + Math.floor(Math.random() * 20); // Base 20% + up to 20% for complexity
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  for (const hit of hits) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  hit.pouScore = Math.min(100, hit.pouScore + pouScoreIncrease);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  await LocalDB.putFile(hit); // Update local file in IndexedDB
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const ledgerColRef = firebase.collection(db, "artifacts", __app_id, "users", userId, "userLedger");
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  await firebase.addDoc(ledgerColRef, {Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  action: `POU: Normalized ${query.substring(0, 30)}...`,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  type: 'POU',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // FIX: PoU Integrity
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  hash: merkelRoot,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // FIX: POU Granularity (Target Fund ID)
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  fundIds: ['FinancialTaxFund'], // Hardcoded for this demo's logic
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  scoreIncrease: `${pouScoreIncrease}%`,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  timestamp: firebase.serverTimestamp()
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  response = `RAG Inference Complete. Analyzed **${hits.length}** financial assets.\n\n`;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  response += `**Proof of Utility (PoU) Block Generated:** This proves data normalization and verification. Each processed asset's PoU Score increased by **${pouScoreIncrease}%**.\n\n`;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  response += `> Check the Ledger for the Merkle Root hash and the Dashboard for your updated Live Average PoU Score.`;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Re-render affected components
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  UI.renderLedger();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  UI.renderVault();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  UI.updateHeader();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  response = "I searched your local vault but found no financial assets matching that query. Upload files or adjust your query.";
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (lastMsg) lastMsg.remove();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  AI.appendChat('ai', response);

Â  Â  Â  Â  Â  Â  Â  Â  }, 1200);
Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  appendChat: (role, text, isLoading = false) => {
Â  Â  Â  Â  Â  Â  Â  Â  const container = document.getElementById('chat-history');
Â  Â  Â  Â  Â  Â  Â  Â  const div = document.createElement('div');
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  const baseClasses = `flex items-start gap-4 ${role === 'user' ? 'flex-row-reverse' : ''} ${isLoading ? 'loading-msg' : ''}`;
Â  Â  Â  Â  Â  Â  Â  Â  // Apply the Gemini/ChatGPT clean bubble style
Â  Â  Â  Â  Â  Â  Â  Â  const contentClasses = role === 'ai'Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ? 'bg-panel border border-border text-primary'Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  : 'bg-accent text-accent-inv';
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  const avatarContent = role === 'ai'
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ? '<i data-feather="cpu" class="w-4 h-4 text-indicator-ok"></i>'
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  : '<i data-feather="user" class="w-4 h-4 text-surface"></i>'; // User icon uses surface for high contrast on teal

Â  Â  Â  Â  Â  Â  Â  Â  // Use strong blue for bolded text in AI response
Â  Â  Â  Â  Â  Â  Â  Â  const formattedText = text.replace(/\*\*(.*?)\*\*/g, '<b style="color: var(--accent);">$1</b>').replace(/\n/g, '<br>');

Â  Â  Â  Â  Â  Â  Â  Â  div.className = baseClasses;
Â  Â  Â  Â  Â  Â  Â  Â  div.innerHTML = `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="w-8 h-8 rounded ${role === 'ai' ? 'bg-panel border border-border' : 'bg-accent'} flex items-center justify-center shrink-0">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${avatarContent}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="${contentClasses} rounded-xl p-4 max-w-2xl text-sm leading-relaxed shadow-lg">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${formattedText}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  Â  Â  Â  Â  container.appendChild(div);
Â  Â  Â  Â  Â  Â  Â  Â  container.scrollTop = container.scrollHeight;
Â  Â  Â  Â  Â  Â  Â  Â  feather.replace();
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  };

Â  Â  Â  Â  const UI = window.UI = {
Â  Â  Â  Â  Â  Â  toggleUserType: () => {
Â  Â  Â  Â  Â  Â  Â  Â  if (userType === 'individual') {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  userType = 'company';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  userId = 'DUMMY_COMPANY_USER_001';
Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  userType = 'individual';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  userId = 'DUMMY_INDIVIDUAL_USER_001';
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  FirebaseInit.loadUserProfile(userId);
Â  Â  Â  Â  Â  Â  Â  Â  Router.nav('dashboard', document.querySelector('.nav-item.active'));
Â  Â  Â  Â  Â  Â  Â  Â  alert(`Switched to **${userType === 'company' ? 'Enterprise Data Buyer' : 'Individual Data Sovereign'}** mode. ID: ${userId}`);
Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  enableApp: () => {
Â  Â  Â  Â  Â  Â  Â  Â  document.querySelectorAll('.view-section').forEach(el => el.style.pointerEvents = 'auto');
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('user-display').innerText = `User ID: ${userId} | Type: ${userType}`;
Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  disableApp: () => {
Â  Â  Â  Â  Â  Â  Â  Â  document.querySelectorAll('.view-section').forEach(el => el.style.pointerEvents = 'none');
Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  // FIX: Dashboard Feedback - Calculate Live Average PoU Score
Â  Â  Â  Â  Â  Â  updateHeader: async () => {
Â  Â  Â  Â  Â  Â  Â  Â  const totalYield = (userProfile.totalYield || []).reduce((sum, item) => sum + item.amount, 0);
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('dash-yield').innerText = `\$${totalYield.toFixed(2)}`;
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('dash-funds-count').innerText = Object.keys(userProfile.funds || {}).length;
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('current-user-type').innerText = userType === 'company' ? 'Enterprise' : 'Individual';

Â  Â  Â  Â  Â  Â  Â  Â  const files = await LocalDB.getAllFiles();
Â  Â  Â  Â  Â  Â  Â  Â  const totalScore = files.reduce((sum, file) => sum + file.pouScore, 0);
Â  Â  Â  Â  Â  Â  Â  Â  const avgPoU = files.length > 0 ? (totalScore / files.length).toFixed(0) : 0;
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('dash-pou-score').innerText = `${avgPoU}%`;
Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  renderVault: async () => {
Â  Â  Â  Â  Â  Â  Â  Â  const vaultHeader = document.getElementById('vault-header-text');
Â  Â  Â  Â  Â  Â  Â  Â  const fileUpload = document.getElementById('file-upload-label');
Â  Â  Â  Â  Â  Â  Â  Â  if (userType !== 'individual') {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  vaultHeader.innerText = 'Data Vault (Read-Only in Enterprise Mode)';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  fileUpload.classList.add('opacity-50', 'pointer-events-none');
Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  vaultHeader.innerText = 'Data Vault ğŸ›¡ï¸';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  fileUpload.classList.remove('opacity-50', 'pointer-events-none');
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  const tbody = document.getElementById('vault-list');
Â  Â  Â  Â  Â  Â  Â  Â  tbody.innerHTML = '';Â 

Â  Â  Â  Â  Â  Â  Â  Â  const files = await LocalDB.getAllFiles();

Â  Â  Â  Â  Â  Â  Â  Â  if (files.length === 0) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  tbody.innerHTML = '<tr><td colspan="4" class="px-6 py-12 text-center text-secondary">Vault is empty. Deposit files to initialize local encryption.</td></tr>';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  files.forEach(file => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // FIX: Allocation Logic - Check if *any* of the fund categories match the file's categories
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const allocatedFundCategories = WorldState.dataFunds
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .filter(fund => userProfile.funds && userProfile.funds[fund.id])
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .map(fund => fund.category);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const fileCategories = file.categories || file.marketCategory.split(', ');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const isAllocated = fileCategories.some(cat => allocatedFundCategories.includes(cat));
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const tr = document.createElement('tr');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  tr.className = 'hover:bg-surface-dark/50 transition-colors'; // Adjusted hover class
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  tr.innerHTML = `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td class="px-6 py-4 text-primary font-medium">${file.name}</td>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td class="px-6 py-4 text-secondary font-code text-xs">${file.marketCategory}</td>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td class="px-6 py-4 ${file.pouScore > 50 ? 'text-indicator-ok' : 'text-secondary'} font-code text-xs">${file.pouScore}%</td>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td class="px-6 py-4">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="${isAllocated ? 'bg-indicator-ok text-surface' : 'bg-secondary text-surface'} px-2 py-1 rounded text-[10px] font-semibold">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${isAllocated ? 'ALLOCATED' : 'FREE'}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </td>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  tbody.prepend(tr);
Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â  feather.replace();
Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  renderLedger: () => {
Â  Â  Â  Â  Â  Â  Â  Â  if (!userId) return;
Â  Â  Â  Â  Â  Â  Â  Â  const container = document.getElementById('ledger-list');
Â  Â  Â  Â  Â  Â  Â  Â  container.innerHTML = '<div class="text-center text-secondary p-5">Loading Ledger...</div>';
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  const ledgerColRef = firebase.collection(db, "artifacts", __app_id, "users", userId, "userLedger");
Â  Â  Â  Â  Â  Â  Â  Â  const q = firebase.query(ledgerColRef, firebase.orderBy("timestamp", "desc"));

Â  Â  Â  Â  Â  Â  Â  Â  firebase.onSnapshot(q, (snapshot) => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  container.innerHTML = '';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (snapshot.empty) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  container.innerHTML = '<div class="text-center text-secondary p-5">Ledger is empty.</div>';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  snapshot.docs.forEach(docSnap => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const block = docSnap.data();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const div = document.createElement('div');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const isYield = block.type === 'YIELD' || block.action.startsWith('SALE');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const isDeposit = block.type === 'POD' || block.action.startsWith('DEPOSIT');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const isPoU = block.type === 'POU';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  div.className = "ledger-entry p-4 rounded font-code text-xs space-y-2 fade-in";
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  div.innerHTML = `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex justify-between text-secondary">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span>TYPE: ${block.type || 'TX'} ${isPoU && block.fundIds ? `(${block.fundIds.join(', ')})` : ''}</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span>${block.timestamp ? new Date(block.timestamp.toDate()).toLocaleString() : 'Pending...'}</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="${isYield ? 'text-indicator-ok' : isDeposit ? 'text-accent' : isPoU ? 'text-indicator-warn' : 'text-primary'} font-semibold truncate">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ACTION: ${block.action} ${block.details ? `â€” ${block.details}` : ''}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="text-secondary text-[10px] block truncate">HASH: ${block.hash ? block.hash.substring(0, 32) + '...' : 'N/A'}</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  container.appendChild(div);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  UI.renderChart(snapshot.docs.map(doc => doc.data()));
Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  renderDataFunds: () => {
Â  Â  Â  Â  Â  Â  Â  Â  const container = document.getElementById('data-funds-list');
Â  Â  Â  Â  Â  Â  Â  Â  container.innerHTML = '';

Â  Â  Â  Â  Â  Â  Â  Â  if (WorldState.dataFunds.length === 0) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Initial Fund Setup (Ensuring new categories are available)
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  WorldState.dataFunds = [
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  { id: 'FinancialTaxFund', name: 'Normalized Tax & Finance Fund', category: 'Financial/Tax', requiredPoU: 70, currentYield: 12.5, description: 'High-value fund for global CPA and wealth management analytics.' },
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  { id: 'UrbanEVFund', name: 'Urban EV Adopters Fund', category: 'Urban/Mobility', requiredPoU: 30, currentYield: 4.8, description: 'Mobility patterns for urban planning and automotive industry analysis.' },
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  { id: 'RetailPulseFund', name: 'Premium Retail Pulse Fund', category: 'Retail/E-commerce', requiredPoU: 50, currentYield: 7.1, description: 'Verified purchase intent data for consumer brands and market sizing.' }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ];
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  WorldState.dataFunds.forEach(fund => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const isAllocated = userProfile.funds && userProfile.funds[fund.id];
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const buttonText = userType === 'individual' ? (isAllocated ? 'DE-ALLOCATE' : 'ALLOCATE ASSETS') : 'ACCESS DATA STREAM';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const buttonColor = userType === 'individual'Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ? (isAllocated ? 'bg-red-700 hover:bg-red-800' : 'bg-accent hover:opacity-80')
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  : 'bg-green-700 hover:bg-green-800';

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const card = document.createElement('div');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  card.className = "bg-panel border border-border p-5 rounded-lg flex flex-col justify-between shadow-lg"; // Enhanced shadow
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  card.innerHTML = `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h4 class="text-xl font-bold mb-1 text-primary">${fund.name}</h4>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-xs text-secondary mb-3">CATEGORY: ${fund.category}</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-4xl font-code text-indicator-warn my-3 font-extrabold">${fund.currentYield}% <span class="text-base text-secondary font-medium">Yield Target</span></p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-sm text-secondary leading-relaxed">${fund.description}</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="mt-4 pt-4 border-t border-border flex justify-between items-center">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="text-xs text-secondary font-code">Min PoU: ${fund.requiredPoU}%</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="${userType === 'individual' ? `DataFunds.toggleFundAllocation('${fund.id}', ${!isAllocated})` : `alert('Enterprise users only view access information here.')`}"
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  class="text-sm text-accent-inv px-4 py-2 rounded font-semibold transition-colors ${buttonColor}">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${buttonText}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  container.appendChild(card);
Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  renderYieldPortfolio: () => {
Â  Â  Â  Â  Â  Â  Â  Â  const tbody = document.getElementById('yield-portfolio-list');
Â  Â  Â  Â  Â  Â  Â  Â  tbody.innerHTML = '';
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  const activeFunds = userProfile.funds || {};
Â  Â  Â  Â  Â  Â  Â  Â  const fundIds = Object.keys(activeFunds);
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  if (fundIds.length === 0) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  tbody.innerHTML = '<tr><td colspan="4" class="px-6 py-4 text-center text-secondary">You are not currently allocated to any fund.</td></tr>';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const lifetimeYield = (userProfile.totalYield || []).reduce((sum, item) => sum + item.amount, 0);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('dash-yield').innerText = `\$${(lifetimeYield).toFixed(2)}`;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('dash-funds-count').innerText = fundIds.length;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  let totalYieldValue = 0;
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  fundIds.forEach(fundId => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const fund = WorldState.dataFunds.find(f => f.id === fundId);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const userData = activeFunds[fundId];
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (!fund) return;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const lastPayout = (Math.random() * 50 + 10).toFixed(2);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  totalYieldValue += parseFloat(lastPayout);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const tr = document.createElement('tr');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  tr.className = 'hover:bg-surface-dark/50 transition-colors';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  tr.innerHTML = `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td class="px-6 py-4 text-primary font-semibold">${fund.name}</td>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td class="px-6 py-4 text-secondary font-code">${userData.assetCount.toFixed(2)} WAC</td>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td class="px-6 py-4 text-indicator-warn font-code font-bold">\ $${lastPayout}</td>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td class="px-6 py-4">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="DataFunds.toggleFundAllocation('${fundId}', false)" class="bg-red-700 text-accent-inv px-3 py-1 rounded text-xs font-semibold hover:bg-red-800 transition-colors" ${userType !== 'individual' ? 'disabled' : ''}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  De-Allocate
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </td>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  tbody.appendChild(tr);
Â  Â  Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  Â  Â  const lifetimeYield = (userProfile.totalYield || []).reduce((sum, item) => sum + item.amount, 0);
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('dash-yield').innerText = `\$${(lifetimeYield + totalYieldValue).toFixed(2)}`;
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('dash-funds-count').innerText = fundIds.length;
Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  // FIX: AI/Intelligence View Guidance
Â  Â  Â  Â  Â  Â  renderIntelligenceView: () => {
Â  Â  Â  Â  Â  Â  Â  Â  const chatContainer = document.getElementById('intelligence-chat-container');
Â  Â  Â  Â  Â  Â  Â  Â  const inputContainer = document.getElementById('intelligence-input-container');

Â  Â  Â  Â  Â  Â  Â  Â  if (userType === 'company') {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  chatContainer.classList.add('hidden');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  inputContainer.innerHTML = `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="p-8 text-primary h-full">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h2 class="text-3xl font-extrabold mb-4 text-accent">Enterprise Query Execution Pipeline ğŸš€</h2>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-secondary mb-8">As an Enterprise Data Buyer, this view shows the **currently executing RAG Queries** used to generate the next batch of tradable SDA bundles.</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="bg-surface-dark border border-border p-6 rounded-lg space-y-4">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="font-code text-sm text-indicator-warn"><i data-feather="check-circle" class="w-4 h-4 inline-block mr-2"></i> Query 1: Normalized Q1 2024 Financial Spend (95% Complete)</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="font-code text-sm text-secondary"><i data-feather="loader" class="w-4 h-4 inline-block mr-2 animate-spin"></i> Query 2: Urban Mobility Trends Q3 2024 (23% Complete)</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="font-code text-sm text-secondary"><i data-feather="clock" class="w-4 h-4 inline-block mr-2"></i> Pending: Retail Purchase Intent (Q4) Aggregation</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="mt-4 text-xs text-secondary">Purchase the finished bundles in the **Data Funds & Yield** view (Simulate B2B Payout button).</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  chatContainer.classList.remove('hidden');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  inputContainer.innerHTML = `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="max-w-4xl mx-auto relative">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="text" id="ai-input" placeholder="Query your local data..." class="ai-input-style w-full rounded-lg py-3 pl-4 pr-12 text-sm font-medium focus:ring-1 focus:ring-accent">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="AI.send()" class="absolute right-2 top-2 p-1.5 hover:bg-panel rounded text-secondary hover:text-accent transition-colors">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <i data-feather="arrow-up" class="w-4 h-4"></i>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('ai-input').addEventListener('keypress', function (e) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (e.key === 'Enter') AI.send();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  feather.replace();
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  renderChart: (ledgerData) => {
Â  Â  Â  Â  Â  Â  Â  Â  const ctx = document.getElementById('vaultChart').getContext('2d');
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  const pouDates = ledgerData
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .filter(b => b.action.startsWith('POU'))
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .map(b => (b.timestamp ? new Date(b.timestamp.toDate()).toLocaleDateString() : 'Pending'));

Â  Â  Â  Â  Â  Â  Â  Â  const counts = pouDates.reduce((acc, date) => { acc[date] = (acc[date] || 0) + 1; return acc; }, {});

Â  Â  Â  Â  Â  Â  Â  Â  let cumulative = 0;
Â  Â  Â  Â  Â  Â  Â  Â  const labels = Object.keys(counts).sort();
Â  Â  Â  Â  Â  Â  Â  Â  const data = labels.map(date => cumulative += counts[date]);

Â  Â  Â  Â  Â  Â  Â  Â  if (window.vaultChartInstance) window.vaultChartInstance.destroy();

Â  Â  Â  Â  Â  Â  Â  Â  window.vaultChartInstance = new Chart(ctx, {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  type: 'line',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  data: {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  labels: labels,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  datasets: [{
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  label: 'Cumulative PoU Blocks',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  data: data,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  borderColor: 'var(--accent)',Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  backgroundColor: 'rgba(14, 116, 144, 0.2)', /* Use new accent color */
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  tension: 0.3,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  fill: true,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  pointRadius: 3,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  pointHoverRadius: 5
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }]
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  options: {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  responsive: true,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  maintainAspectRatio: false,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  plugins: {Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  legend: { display: false },
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  tooltip: { mode: 'index', intersect: false, bodyFont: { family: 'JetBrains Mono' } }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  scales: {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  y: {Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  beginAtZero: true,Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  grid: { color: 'rgba(51, 65, 85, 0.5)' },Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ticks: { color: 'var(--text-sec)', font: { family: 'JetBrains Mono' } }Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  x: {Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  grid: { display: false },Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ticks: { color: 'var(--text-sec)', font: { family: 'JetBrains Mono' } }Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  };
Â  Â  Â  Â Â 
Â  Â  Â  Â  // --- INITIALIZATION BLOCK (Executes after module load) ---
Â  Â  Â  Â  window.onload = async () => {
Â  Â  Â  Â  Â  Â  feather.replace();Â 
Â  Â  Â  Â  Â  Â  await LocalDB.init();
Â  Â  Â  Â  Â  Â  await FirebaseInit.setup();
Â  Â  Â  Â  Â  Â  Router.nav('dashboard', document.querySelector('.nav-item.active'));

Â  Â  Â  Â  Â  Â  // Re-attach event listener for the dynamic input in Individual mode
Â  Â  Â  Â  Â  Â  const intelligenceView = document.getElementById('view-intelligence');
Â  Â  Â  Â  Â  Â  new MutationObserver((mutationsList, observer) => {
Â  Â  Â  Â  Â  Â  Â  Â  const input = document.getElementById('ai-input');
Â  Â  Â  Â  Â  Â  Â  Â  if (input) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  input.removeEventListener('keypress', AI.sendOnEnter);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  input.addEventListener('keypress', function(e) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (e.key === 'Enter') AI.send();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }).observe(intelligenceView, { childList: true, subtree: true });
Â  Â  Â  Â  };
Â  Â  </script>
</head>
<body class="flex bg-os min-h-screen"> <aside class="w-64 bg-panel border-r border-border flex flex-col z-20 shrink-0 h-screen sticky top-0">Â 
Â  Â  Â  Â  <div class="p-6 flex items-center gap-3 select-none border-b border-border">
Â  Â  Â  Â  Â  Â  <i data-feather="hexagon" class="text-accent w-6 h-6"></i>
Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  <h1 class="font-extrabold tracking-tight text-xl leading-none font-code text-primary">WORL<span class="opacity-50">DOS</span></h1>
Â  Â  Â  Â  Â  Â  Â  Â  <span class="text-[10px] text-secondary font-code uppercase tracking-widest">Sovereign Funds</span>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>

Â  Â  Â  Â  <nav class="flex-1 px-4 py-6 space-y-1">
Â  Â  Â  Â  Â  Â  <button onclick="Router.nav('dashboard', this)" class="nav-item w-full flex items-center gap-3 px-3 py-2.5 rounded-sm text-sm font-medium active">
Â  Â  Â  Â  Â  Â  Â  Â  <i data-feather="grid" class="w-4 h-4"></i> Dashboard
Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  <button onclick="Router.nav('intelligence', this)" class="nav-item w-full flex items-center gap-3 px-3 py-2.5 rounded-sm text-sm font-medium">
Â  Â  Â  Â  Â  Â  Â  Â  <i data-feather="cpu" class="w-4 h-4"></i> Neural Core (PoU)
Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  <button onclick="Router.nav('vault', this)" class="nav-item w-full flex items-center gap-3 px-3 py-2.5 rounded-sm text-sm font-medium">
Â  Â  Â  Â  Â  Â  Â  Â  <i data-feather="database" class="w-4 h-4"></i> Data Vault
Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  <button onclick="Router.nav('marketplace', this)" class="nav-item w-full flex items-center gap-3 px-3 py-2.5 rounded-sm text-sm font-medium">
Â  Â  Â  Â  Â  Â  Â  Â  <i data-feather="dollar-sign" class="w-4 h-4 text-indicator-warn"></i> Data Funds & Yield
Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  <button onclick="Router.nav('ledger', this)" class="nav-item w-full flex items-center gap-3 px-3 py-2.5 rounded-sm text-sm font-medium">
Â  Â  Â  Â  Â  Â  Â  Â  <i data-feather="list" class="w-4 h-4"></i> Transaction Ledger
Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  </nav>

Â  Â  Â  Â  <div class="p-4 border-t border-border">
Â  Â  Â  Â  Â  Â  Â <button onclick="UI.toggleUserType()" class="w-full text-secondary hover:text-accent text-sm flex items-center gap-2 transition-colors mb-3 font-semibold">
Â  Â  Â  Â  Â  Â  Â  Â  <i data-feather="repeat" class="w-4 h-4"></i> Switch User Mode
Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  <p class="text-[10px] text-zinc-600 mt-2 font-code truncate" id="user-display">User: DUMMY_INDIVIDUAL_USER_001 | Type: individual</p>
Â  Â  Â  Â  </div>
Â  Â  </aside>

Â  Â  <div id="main" class="flex-1 flex flex-col relative bg-surface-dark overflow-auto">Â 
Â  Â  Â  Â  <header class="h-16 border-b border-border flex items-center justify-between px-8 sticky top-0 bg-panel/90 backdrop-blur-sm z-10 shrink-0">
Â  Â  Â  Â  Â  Â  <div class="text-sm font-code text-secondary">
Â  Â  Â  Â  Â  Â  Â  Â  <span id="current-user-type" class="font-semibold text-primary">Individual</span> Node ~ <span class="text-accent" id="breadcrumb">/dashboard</span>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div class="flex items-center gap-4">
Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex items-center gap-2 px-3 py-1 rounded-full bg-surface-dark border border-border">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <i data-feather="server" class="w-3 h-3 text-secondary"></i>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="text-xs font-code text-primary" id="storage-usage">0 MB</span>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </header>

Â  Â  Â  Â  <div class="flex-1 relative">
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  <div id="view-dashboard" class="view-section absolute inset-0 p-8 fade-in active space-y-8">
Â  Â  Â  Â  Â  Â  Â  Â  <h2 class="text-3xl font-extrabold mb-6 text-primary">Financial Data Fund Summary</h2>
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="bg-panel border border-border p-6 rounded-lg shadow-lg">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="text-secondary text-sm font-medium uppercase tracking-wider mb-2">Total Yield Earned</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="text-5xl font-code font-bold text-indicator-ok" id="dash-yield">$0.00</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="mt-4 text-xs text-secondary border-t border-border pt-3">Lifetime Royalties (Post-Commission)</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="bg-panel border border-border p-6 rounded-lg shadow-lg">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="text-secondary text-sm font-medium uppercase tracking-wider mb-2">Fund Allocation</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="text-5xl font-code font-bold text-accent" id="dash-funds-count">0</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="mt-4 text-xs text-secondary border-t border-border pt-3">Active Funds Contributed To</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="bg-panel border border-border p-6 rounded-lg shadow-lg">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="text-secondary text-sm font-medium uppercase tracking-wider mb-2">Verified Utility Score (PoU)</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="text-5xl font-code font-bold text-primary" id="dash-pou-score">0%</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="mt-4 text-xs text-secondary border-t border-border pt-3">Average PoU of All Local Assets</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  <div class="bg-panel border border-border rounded-lg p-6 shadow-xl">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex justify-between items-center mb-4">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h3 class="text-xl font-bold text-primary">Proof of Utility (PoU) Activity</h3>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="text-xs text-secondary font-code">RAG INFERENCE // DATA VALUE METRIC</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="h-64">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <canvas id="vaultChart"></canvas>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  <div id="view-ledger" class="view-section absolute inset-0 hidden p-8 fade-in">
Â  Â  Â  Â  Â  Â  Â  Â  <h2 class="text-3xl font-extrabold mb-6 text-primary">Transaction Ledger (PoD & Yield) â›“ï¸</h2>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="space-y-3" id="ledger-list">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  <div id="view-marketplace" class="view-section absolute inset-0 hidden p-8 fade-in">
Â  Â  Â  Â  Â  Â  Â  Â  <h2 class="text-3xl font-extrabold mb-4 text-primary">Data Funds Index</h2>
Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-secondary mb-8 text-lg">Invest your sovereign data into thematic funds to earn passive, recurring yield (royalties).</p>
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-12" id="data-funds-list">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  <h3 class="text-2xl font-bold mt-8 mb-4 text-primary border-b border-border pb-2">My Yield Portfolio (Weighted Asset Count $\text{WAC} = \sum (\text{PoU} \times \text{Weight})$)</h3>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="bg-panel border border-border rounded-lg overflow-hidden shadow-xl">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <table class="w-full text-sm text-left">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <thead class="bg-surface-dark text-secondary font-medium border-b border-border uppercase tracking-wider">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <tr>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <th class="px-6 py-4">Fund Name</th>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <th class="px-6 py-4">Your WAC (Yield Share)</th>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <th class="px-6 py-4">Sim. Last Payout</th>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <th class="px-6 py-4">Action</th>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </tr>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </thead>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <tbody id="yield-portfolio-list" class="divide-y divide-border">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <tr><td colspan="4" class="px-6 py-8 text-center text-secondary">You are not currently allocated to any fund.</td></tr>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </tbody>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </table>
Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  <div class="mt-8 flex justify-end">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="DataFunds.simulatePayout()" class="bg-blue-600 text-white px-5 py-2.5 rounded font-semibold hover:bg-blue-700 transition-colors shadow-lg">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Simulate B2B Payout (Company User Only)
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  <div id="view-intelligence" class="view-section absolute inset-0 hidden p-8">
Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex flex-col h-full bg-panel border border-border rounded-lg overflow-hidden shadow-2xl">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex-1 p-6 font-code text-sm space-y-6 overflow-y-auto" id="chat-history">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex items-start gap-4">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="w-8 h-8 rounded bg-panel border border-border flex items-center justify-center shrink-0">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <i data-feather="cpu" class="w-4 h-4 text-indicator-ok"></i>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="bg-panel border border-border rounded-xl p-4 max-w-2xl text-sm leading-relaxed text-primary shadow-lg">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p><b style="color: var(--accent);">Neural Core Online.</b> Ready for RAG queries on your uploaded **financial assets** (e.g., "Normalize Q4 spend").</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="mt-2 text-secondary">This process generates **Proof of Utility (PoU)** blocks, boosting the value of your Data Fund allocations.</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="p-4 border-t border-border bg-surface-dark shrink-0" id="intelligence-input-container">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="max-w-4xl mx-auto relative">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="text" id="ai-input" placeholder="Query your local data..." class="ai-input-style w-full rounded-lg py-3 pl-4 pr-12 text-sm font-medium focus:ring-1 focus:ring-accent">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="AI.send()" class="absolute right-2 top-2 p-1.5 hover:bg-panel rounded text-secondary hover:text-accent transition-colors">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <i data-feather="arrow-up" class="w-4 h-4"></i>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  <div id="view-vault" class="view-section absolute inset-0 hidden p-8 fade-in">
Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex justify-between items-center mb-6">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h2 class="text-3xl font-extrabold text-primary" id="vault-header-text">Data Vault ğŸ›¡ï¸</h2>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label id="file-upload-label" class="cursor-pointer bg-accent text-accent-inv hover:bg-opacity-80 px-5 py-2.5 rounded font-semibold text-sm transition-colors flex items-center gap-2 shadow-lg">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <i data-feather="upload-cloud" class="w-4 h-4"></i> Deposit Financial Data
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="file" class="hidden" id="file-upload" onchange="Vault.ingest(this)">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </label>
Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  <div class="bg-panel border border-border rounded-lg overflow-hidden shadow-xl">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <table class="w-full text-sm text-left">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <thead class="bg-surface-dark text-secondary font-medium border-b border-border uppercase tracking-wider">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <tr>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <th class="px-6 py-4">Asset Name</th>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <th class="px-6 py-4">Category(s)</th>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <th class="px-6 py-4">PoU Score</th>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <th class="px-6 py-4">Allocation</th>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </tr>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </thead>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <tbody id="vault-list" class="divide-y divide-border">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </tbody>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </table>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  </div>
Â  Â  </div>
</body>
</html>
